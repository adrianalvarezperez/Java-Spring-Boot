create database FabricaRopa;

use FabricaRopa;

CREATE TABLE USUARIOS(
USERNAME VARCHAR(45) NOT NULL primary key,
PASSWORD VARCHAR(45) NOT NULL,
EMAIL VARCHAR(100) NOT NULL UNIQUE,
NOMBRE VARCHAR(50),
DIRECCION VARCHAR(100),
ENABLED INT NOT NULL DEFAULT 1,
FECHA_REGISTRO DATE
);

CREATE TABLE PERFILES(
ID_PERFIL INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOMBRE VARCHAR(45) NOT NULL
);

CREATE TABLE USUARIO_PERFILES(
USERNAME VARCHAR(45) NOT NULL,
ID_PERFIL INT NOT NULL,
PRIMARY KEY(USERNAME, ID_PERFIL),
FOREIGN KEY(USERNAME) REFERENCES USUARIOS(USERNAME),
FOREIGN KEY(ID_PERFIL) REFERENCES PERFILES(ID_PERFIL)
);

CREATE TABLE PEDIDOS(
  ID_PEDIDO INTEGER NOT NULL auto_increment PRIMARY KEY,
  FECHA_ALTA DATE,
  DOMICILIO_ENTREGA VARCHAR(100) NOT NULL,
  ESTADO  VARCHAR(20) NOT NULL,
  USERNAME VARCHAR(45) NOT NULL,
  CONSTRAINT PEDIDOS_USU_FK FOREIGN KEY(USERNAME) REFERENCES USUARIOS(USERNAME)
);

CREATE TABLE FAMILIAS(
ID_FAMILIA INT PRIMARY KEY AUTO_INCREMENT,
DESCRIPCION VARCHAR(50)
);

CREATE TABLE PRODUCTOS(
ID_PRODUCTO INT PRIMARY KEY AUTO_INCREMENT,
DESCRIPCION VARCHAR(200) NOT NULL,
FECHA_ALTA DATE,
PRECIO_UNITARIO DEC(9,2),
ID_FAMILIA INT NOT NULL,
FOREIGN KEY(ID_FAMILIA) REFERENCES FAMILIAS(ID_FAMILIA)
);

CREATE TABLE PRODUCTOS_EN_PEDIDO(
  NUM_ORDEN INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ID_PEDIDO INTEGER NOT NULL,
  ID_PRODUCTO INT NOT NULL,
  CANTIDAD INTEGER,
  PRECIO_VENTA DEC(9,2),
  CONSTRAINT LINEAS_PED_IDP_FK FOREIGN KEY(ID_PEDIDO) REFERENCES PEDIDOS(ID_PEDIDO),
  CONSTRAINT LINEAS_PED_IDPROD_FK FOREIGN KEY(ID_PRODUCTO) REFERENCES PRODUCTOS(ID_PRODUCTO)
);
/*
insert de las tablas
*/
use FabricaRopa;
/*
-- Query: SELECT * FROM FabricaRopa.familias
LIMIT 0, 1000

-- Date: 2022-11-24 00:05
*/
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (1,'CAMISAS');
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (2,'PANTALONES');
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (3,'ZAPATOS');
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (4,'JERSEY');
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (6,'BOLSOS');
INSERT INTO `familias` (`ID_FAMILIA`,`DESCRIPCION`) VALUES (7,'GORRAS');

/*
-- Query: SELECT * FROM FabricaRopa.productos
LIMIT 0, 1000

-- Date: 2022-11-24 00:06
*/
INSERT INTO `productos` (`ID_PRODUCTO`,`DESCRIPCION`,`FECHA_ALTA`,`PRECIO_UNITARIO`,`ID_FAMILIA`) VALUES (1,'Camisa blanca Mujer Talla S','2020-12-01',12.00,1);
INSERT INTO `productos` (`ID_PRODUCTO`,`DESCRIPCION`,`FECHA_ALTA`,`PRECIO_UNITARIO`,`ID_FAMILIA`) VALUES (2,'Camisa zaul Mujer talla M','2020-06-12',65.00,1);
INSERT INTO `productos` (`ID_PRODUCTO`,`DESCRIPCION`,`FECHA_ALTA`,`PRECIO_UNITARIO`,`ID_FAMILIA`) VALUES (5,'pantalon vaquero','2021-09-12',67.00,2);

/*
-- Query: SELECT * FROM FabricaRopa.usuarios
LIMIT 0, 1000

-- Date: 2022-11-24 00:06
*/
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('damian','damian','damian@ee.es','damianico','madrid',1,'2021-11-14');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('ESTEBAN','esteban','esteban@ee.es','estebann','madrid',1,'2021-11-14');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('ESTEBAN2','esteban','esteban2@ee.es','estebann','madrid',1,'2021-11-14');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('eva','evita','eva@ee.es','eva santos','sevilla',1,'2021-06-06');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('marta','marta','marta@ee.com','marta','marta sss',1,'2021-11-22');
INSERT INTO `usuarios` (`USERNAME`,`PASSWORD`,`EMAIL`,`NOMBRE`,`DIRECCION`,`ENABLED`,`FECHA_REGISTRO`) VALUES ('tomas','tomasin','tomas@yy.com','tomas escudero','madrid',1,'2021-07-14');

/*
-- Query: SELECT * FROM FabricaRopa.perfiles
LIMIT 0, 1000

-- Date: 2022-11-24 00:07
*/
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (1,'ADMINISTRADOR');
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (2,'GESTOR');
INSERT INTO `perfiles` (`ID_PERFIL`,`NOMBRE`) VALUES (3,'CLIENTE');
/*
-- Query: SELECT * FROM FabricaRopa.usuario_perfiles
LIMIT 0, 1000

-- Date: 2022-11-24 00:07
*/
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('tomas',1);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('marta',2);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('tomas',2);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('damian',3);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('ESTEBAN',3);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('ESTEBAN2',3);
INSERT INTO `usuario_perfiles` (`USERNAME`,`ID_PERFIL`) VALUES ('eva',3);

/*
estas tres sentencias es para crear un usuario y otorgarle privilegios para usar la
base de datos.
y por supuesto estas sentencias desde root
Para consultar los usuarios de mysql:
*/
 CREATE USER ufabrica IDENTIFIED BY 'ufabrica';
 grant all privileges on FabricaRopa.* to  ufabrica; 
FLUSH PRIVILEGES;
/*
si por lo que sea quiers borrar el usaurio : 
drop user 'fabrica'@'localhost';
*/
/* 
si quieres saber los usuarios de mysql y el host al que est√° asignado
SELECT User, Host FROM mysql.user;
*/